<?php include APP_PATH.'/public/admin/header_meta.html' ?>
<?php include APP_PATH.'/public/admin/header.html' ?>
<section id="main" data-layout="layout-1">
    <div class="modal fade" id="m-ud-article" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close close-modal" data-dismiss="modal" aria-hidden="true">
                        ×
                    </button>
					<ul class="nav nav-tabs" id="uptablist1">
	                   <li class="active"><a href="#upzhnews">简体中文</a></li>
	                   <li class="active"><a href="#upennews">英文</a></li>
	                   <li class="active"><a href="#upkanews">韩文</a></li>
	                   <li class="active"><a href="#upjsnews">日文</a></li>
					</ul>
                    
                </div>
                <div class="modal-body form-horizontal" style="height: 500px;overflow-y:auto;">
					<!---------中文开始----------->
					<form action="/admin/linkimg/updateById" id="updateform" method="post">
						<div id="upzhnews">
							<div class="form-group">
								<label  class="col-sm-3 control-label">ID</label>
								<label  class="col-sm-8 control-label" id="zhuid" style="text-align: left;"></label>
								<input type="hidden" id="zhid" name="zhnews[id]">
							</div>
							<div class="form-group">
								<label for="updatename" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="zhtitle" class="form-control input-sm" name="zhnews[title]" placeholder="中文 新闻名称">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="updateTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="zhdescript" class="form-control input-sm" name="zhnews[descript]" placeholder="中文 新闻描述">
									</div>
								</div>
							</div>
							
							
							<div class="form-group">
								<label for="updateLevel" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="zhsort" class="form-control input-sm" name="zhnews[sort]" placeholder="中文 排序">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" id="zhthumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="zhfile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!----中文结束----->
						
						<!---------英文开始----------->
						<div id="upennews" style="display:none">
							<div class="form-group">
								<label  class="col-sm-3 control-label">ID</label>
								<label  class="col-sm-8 control-label" id="enuid" style="text-align: left;"></label>
								<input type="hidden" id="enid"  name="ennews[id]">
							</div>
							<div class="form-group">
								<label for="updatename" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="entitle" class="form-control input-sm" name="ennews[title]" placeholder="英文 新闻名称">
									</div>
								</div>
							</div>
							
							
							<div class="form-group">
								<label for="updateTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="endescript" class="form-control input-sm" name="ennews[descript]" placeholder="英文 新闻描述">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="updateLevel" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="ensort" class="form-control input-sm" name="ennews[sort]" placeholder="英文 排序">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" id="enthumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="enfile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>
						<!---------英文结束----------->
						
						<!---------韩文开始----------->
						<div id="upkanews" style="display:none">
							<div class="form-group">
								<label  class="col-sm-3 control-label">ID</label>
								<label  class="col-sm-8 control-label" id="kauid" style="text-align: left;"></label>
								<input type="hidden" id="kaid"  name="kanews[id]">
							</div>
							<div class="form-group">
								<label for="updatename" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="katitle" class="form-control input-sm" name="kanews[title]" placeholder="韩文 新闻名称">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="updateTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="kadescript" class="form-control input-sm" name="kanews[descript]" placeholder="韩文 新闻描述">
									</div>
								</div>
							</div>
							
							
							
							<div class="form-group">
								<label for="updateLevel" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="kasort" class="form-control input-sm" name="kanews[sort]" placeholder="韩文 排序">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" id="kathumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="kafile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!---------韩文结束----------->
						
						<!---------日文开始----------->
						<div id="upjsnews" style="display:none">
							<div class="form-group">
								<label  class="col-sm-3 control-label">ID</label>
								<label  class="col-sm-8 control-label" id="jsuid" style="text-align: left;"></label>
								<input type="hidden" id="jsid"  name="jsnews[id]">
							</div>
							<div class="form-group">
								<label for="updatename" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="jsname" class="form-control input-sm" name="jsnews[title]" placeholder="日文 新闻名称">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="updateTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="jstitle" class="form-control input-sm" name="jsnews[descript]" placeholder="日文 新闻描述">
									</div>
								</div>
							</div>
							
							
							<div class="form-group">
								<label for="updateLevel" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="jslevel" class="form-control input-sm" name="jsnews[sort]" placeholder="日文 排序">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" id="jsthumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="jsfile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!---------日文结束----------->
						
						
					</form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect btn-update">修改</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="m-add-article" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close close-modal" data-dismiss="modal" aria-hidden="true">
                        ×
                    </button>

					<ul class="nav nav-tabs" id="tablist1">
	                   <li class="active"><a href="#zhnews"  style="background-color: #2196f3;">简体中文</a></li>
	                   <li class="active"><a href="#ennews">英文</a></li>
	                   <li class="active"><a href="#kanews">韩文</a></li>
	                   <li class="active"><a href="#jsnews">日文</a></li>
					</ul>
                </div>
                <div class="modal-body form-horizontal" style="height: 500px;overflow-y:auto;">
					<form action="/admin/linkimg/add" id="addform" method="post" name="myform" enctype="multipart/form-data">
						<!---------中文开始----------->
						<div id="zhnews">
							<div class="form-group">
								<label for="addName" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addName" name="zhnews[title]" placeholder="中文 新闻名称">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="addTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addTitle" name="zhnews[descript]" placeholder="中文 新闻描述">
									</div>
								</div>
							</div>
							
									
							<div class="form-group">
								<label for="Level" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="Level" class="form-control input-sm" name="zhnews[sort]" placeholder="中文 排序">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="zhfile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>
						<!---------中文结束----------->
						<!---------英文开始----------->
						<div id="ennews" style="display:none">
							<div class="form-group">
								<label for="addName" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addName" name="ennews[title]" placeholder="英文 新闻名称">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="addTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addTitle" name="ennews[descript]" placeholder="英文 新闻描述">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="Level" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="Level" class="form-control input-sm" name="ennews[sort]" placeholder="英文 排序">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="enfile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>	
						<!---------英文结束----------->
						
						<!---------韩文开始----------->
						<div id="kanews" style="display:none">
							<div class="form-group">
								<label for="addName" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addName" name="kanews[title]" placeholder="韩文 新闻名称">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="addTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addTitle" name="kanews[descript]" placeholder="韩文 新闻描述">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="Level" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="Level" class="form-control input-sm" name="kanews[sort]" placeholder="韩文 排序">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="kafile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>	
						<!---------韩文结束----------->
						
						<!---------日文开始----------->
						<div id="jsnews" style="display:none">
							<div class="form-group">
								<label for="addName" class="col-sm-3 control-label">新闻名称</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addName" name="jsnews[title]" placeholder="日文 新闻名称">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="addTitle" class="col-sm-3 control-label">新闻描述</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" class="form-control input-sm" id="addTitle" name="jsnews[descript]" placeholder="日文 新闻描述">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label for="Level" class="col-sm-3 control-label">排序</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<input type="text" id="Level" class="form-control input-sm" name="jsnews[sort]" placeholder="日文 排序">
									</div>
								</div>
							</div>
							<div class="form-group">
								<label  class="col-sm-3 control-label">缩略图</label>
								<div class="col-sm-8">
									<div class="fg-line">
										<div class="fileinput fileinput-new" data-provides="fileinput">
											<div class="fileinput-preview thumbnail" data-trigger="fileinput"></div>
											<div>
										<span class="btn btn-info btn-file">
											<span class="fileinput-new">选择图片</span>
											<span class="fileinput-exists">重新选择</span>
											<input id="fileinput" type="file" name="jsfile">
										</span>
												<a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">移除</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>	
						<!---------日文结束----------->
					</form>
					
					
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect btn-insert">添加</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <aside id="sidebar" class="sidebar c-overflow toggled">
        <?php include APP_PATH.'/public/admin/menu_left.html' ?>
    </aside>
    <section id="content">
        <div class="container">
            <div id="myeditor"></div>
            <div class="card">
                <div class="card-header">
                    <h2>新闻内容列表 <small>管理所有新闻内容等操作.</small></h2>
                </div>
                <div class="table-responsive">
                    <table id="data-table-selection" class="table table-striped">
                        <thead>
                        <tr>
                            <th data-column-id="id" data-order="desc" data-type="numeric" data-identifier="true">ID</th>
                            <th data-column-id="title">新闻名称</th>
                            <th data-column-id="descript" >描述</th>
                            <th data-column-id="creater">创建人</th>
                            <th data-column-id="sort">排序</th>
                            <th data-column-id="commands" data-formatter="commands" data-sortable="false">操作</th>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </section>
</section>
<script>
    //全局变量
    require(['pathCnf'],function (pathCnf) {
        require(['bootgrid','bootstrapSelect','sweetAlert','summernote-zh','fileinput','jqueryform'],function () {
            $('.selectpicker').selectpicker({
                style: 'btn-default',
                size: 4
            });
            var grid=$("#data-table-selection").bootgrid({
                ajax: true,
                post: function ()
                {
                    /* To accumulate custom parameter with the request object */
                    return {
                        id: "b0df282a-0d67-40e5-8558-c9e93b7befed"
                    };
                },
                selection: true,
                multiSelect: true,
                rowSelect: true,
                keepSelection: true,
                url: "/admin/linkimg/tabPage",
                responseHandler:function (data) {
                    var ret={
                        "current": data.data.current,
                        "rowCount": data.data.rowCount,
                        "rows":data.data.data,
                        "total": data.data.total
                    }
                    return ret;
                },
                templates: {
                    actions: '<div class="actions btn-group"><div class="dropdown btn-group"><button class="btn btn-default btn-add"><span class="zmdi zmdi-account-add zmdi-hc-fw"></span></button></div></div>',
                    actionButton:'<div class="dropdown btn-group"><button class="btn btn-default"><span class="zmdi zmdi-refresh zmdi-hc-fw"></span></button></div>'
                },
                formatters: {
					"status":function (column, row) {
							var str='';
							console.log(row);
							switch (row.status){
								case '0':
									str='编辑中';
									break;
								case '1':
									str='审核中';
									break;
								case '2':
									str='审核通过';
									break;
								case '3':
									str='审核失败';
									break;
								case '4':
									str='已删除';
									break;
							}
							return str;
						},
                    /*"nstatus":function (column, row) {
                        var str='';
                        console.log(row);
                        switch (row.nstatus){
                            case '0':
                                str='不显示';
                                break;
                            case '1':
                                str='显示';
                                break;
                        }
                        return str;
                    },*/
                    "commands": function(column, row)
                    {
                        var btn_publish=("<?php if(unserialize($_SESSION['user']['permission'])['is_administortar']==1){ echo '<button type=\"button\" class=\"btn btn-icon bgm-white waves-effect waves-circle btn_publish\" data-row-id=\"" + row.id + "\"><span class=\"zmdi zmdi-tv-alt-play zmdi-hc-fw\"></span></button>'; }?>");

                        var btn_edit=("<?php if(unserialize($_SESSION['user']['permission'])['is_administortar']==1){ echo '<button type=\"button\" class=\"btn btn-icon bgm-white waves-effect waves-circle btn_update\" data-row-id=\"" + row.id + "\"><span class=\"zmdi zmdi-edit\"></span></button>'; }?>");

                        var btn_delete=("<?php if(unserialize($_SESSION['user']['permission'])['is_administortar']==1){ echo '<button type=\"button\" class=\"btn btn-icon bgm-white waves-effect waves-circle btn_delete\" data-row-id=\"" + row.id + "\"><span class=\"zmdi zmdi-delete\"></span></button>'; }?>");

                        return btn_edit+btn_delete;
                    }
                }
            }).on('loaded.rs.jquery.bootgrid',function () {
                grid.find('.btn_update').on('click',function (e) {
                    var target=e.target.tagName=="BUTTON"?$(e.target):$(e.target).parent();
                    $('#txt_uid').text(target.attr('data-row-id'));
                    $.ajax({
                        type:"get",
                        url:"/admin/linkimg/getArticleById",
                        data:{'id':target.attr('data-row-id')},
                        async:true,
                        dataType:'json',
                        beforeSend:function () {
                            $("#m-ud-article").find('.modal-body').ajax_loader({size:'pl-lg',color:'pls-green'});
                        },
                        complete:function () {
                            setTimeout(function () {
                                $("#m-ud-article").find('.ajax-loader').fadeOut();
                            },100);
                        },
                        success:function (data) {
                            if(data.code==0){
								//中文
                                $("#updateform .fileinput-preview").html('');
                                $('#updateform #zhid').val(data.data.zhdata.id);
                                $('#updateform #zhtitle').val(data.data.zhdata.title);
                                $('#updateform #zhdescript').val(data.data.zhdata.descript);
                                $('#updateform #zhsort').val(data.data.zhdata.sort);
								
								//console.log(data.data.zhdata.icon);
								//英文
								$("#updateform .fileinput-preview").html('');
                                $('#updateform #enid').val(data.data.endata.id);
                                $('#updateform #entitle').val(data.data.endata.title);
                                $('#updateform #endescript').val(data.data.endata.descript);
                                $('#updateform #ensort').val(data.data.endata.sort);
                                $('#updateform #enkeyWords').val(data.data.endata.keywords);
								
								//韩文
								if(data.data.kadata!=""){
									$("#updateform .fileinput-preview").html('');
									$('#updateform #kaid').val(data.data.kadata.id);
									$('#updateform #katitle').val(data.data.kadata.title);
									$('#updateform #kadescript').val(data.data.kadata.descript);
									$('#updateform #kasort').val(data.data.kadata.sort);
								}
								
								//日文
								if(data.data.jsdata!=""){
									$("#updateform .fileinput-preview").html('');
									$('#updateform #jsid').val(data.data.jsdata.id);
									$('#updateform #jstitle').val(data.data.jsdata.title);
									$('#updateform #jsicon').val(data.data.jsdata.icon);
									$('#updateform #jsdescript').val(data.data.jsdata.descript);
									$('#updateform #jssort').val(data.data.jsdata.sort);
									
								}
								
								
                                $("#updateform .fileinput").removeClass('fileinput-new').addClass('fileinput-exists');
								$("#updateform #zhthumbnail").append('<img src="'+data.data.zhdata.icon+'">').css('line-height','150px');
								$("#updateform #enthumbnail").append('<img src="'+data.data.endata.icon+'">').css('line-height','150px');
								$("#updateform #kathumbnail").append('<img src="'+data.data.kadata.icon+'">').css('line-height','150px');
                                $("#updateform #jsthumbnail").append('<img src="'+data.data.jsdata.icon+'">').css('line-height','150px');
                            }

                        }
                    });
                    $("#m-ud-article").modal('show');
                });
                grid.find('.btn_delete').on('click',function (e) {
                    var id=$(this).attr('data-row-id');
                    swal({
                        title: "你将要删除这个新闻记录吗?",
                        text: "如果你删除了,将无法恢复!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "delete",
                        closeOnConfirm: false
                    }, function(){
                        $.ajax({
                            type:"post",
                            url:"/admin/linkimg/delete",
                            data:{'id':id},
                            async:true,
                            dataType:'json',
                            beforeSend:function () {
                                $("#data-table-selection").ajax_loader({size:'pl-lg',color:'pls-green'});
                            },
                            complete:function () {
                                setTimeout(function () {
                                    $("#data-table-selection").find('.ajax-loader').fadeOut();
                                },100);
                            },
                            success:function (data) {
                                if(data.code=='0'){
                                    swal("已删除!", "当前新闻记录已删除.", "success");
                                    $("#data-table-selection").bootgrid("reload");
                                }else if(data.code=='3'){
                                    swal('操作失败','没有权限,请联系管理员!');
                                }else{
                                    swal('操作失败');
                                }
                            }
                        })

                    });
                });
                grid.find('.btn_search').on('click',function (e) {
                    var id=$(this).attr('data-row-id');
                    window.open("../zhaac/item?id="+id);
                })
            });
            $("body").on('click',function (e) {
                if(e.target.className.indexOf('btn-update')>0){
                    $('.zhupContent').val(Base64.encode($('.zhupContent').summernote('code')));
                    $('.enupContent').val(Base64.encode($('.enupContent').summernote('code')));
                    $('.kaupContent').val(Base64.encode($('.kaupContent').summernote('code')));
                    $('.jsupContent').val(Base64.encode($('.jsupContent').summernote('code')));
                    var options={
                        dataType:'json',
                        success:function (data) {
                            if(data.code=='0'){
                                $("#m-ud-article").modal("hide");
                                $("#data-table-selection").bootgrid("reload");
                            }else if(data.code==1002) {
								swal(data.msg);
							}else if(data.code=='3'){
                                swal('操作失败','没有权限,请联系管理员!');
                            }else{
                                swal('操作失败');
                            }
                        }
                    };
                    $("#updateform").ajaxSubmit(options);
                }
//                m-add-article
                //打开添加按钮
                if(e.target.tagName=='BUTTON'||e.target.tagName=='SPAN'){
                    if(e.target.className.indexOf('btn-add')>0||e.target.parentNode.className.indexOf('btn-add')>0){
                        $("#m-add-article").modal("show");
						//中文
                        var $zhsummernote=$('.zhaddContent').summernote({
                            height: 250,
                            lang: 'zh-CN',
                            callbacks: {
                                onImageUpload: function(files) {
                                    sendFile($zhsummernote,files[0]);
                                }
                            }
                        });
						//英文
						var $ensummernote=$('.enaddContent').summernote({
                            height: 250,
                            lang: 'zh-CN',
                            callbacks: {
                                onImageUpload: function(files) {
                                    sendFile($ensummernote,files[0]);
                                }
                            }
                        });
						//韩文
						var $kasummernote=$('.kaaddContent').summernote({
                            height: 250,
                            lang: 'zh-CN',
                            callbacks: {
                                onImageUpload: function(files) {
                                    sendFile($kasummernote,files[0]);
                                }
                            }
                        });
						//日文
						var $jssummernote=$('.jsaddContent').summernote({
                            height: 250,
                            lang: 'zh-CN',
                            callbacks: {
                                onImageUpload: function(files) {
                                    sendFile($jssummernote,files[0]);
                                }
                            }
                        });
                        //$("#sl_artType").selectpicker('val',0);
                        $('.zhaddContent').summernote('code','');
                        $('.enaddContent').summernote('code','');
                        $('.kaaddContent').summernote('code','');
                        $('.jsaddContent').summernote('code','');
                    }
                }
                //添加按钮
                if(e.target.className.indexOf('btn-insert')>0){
                    $('.zhaddContent').val(Base64.encode($('.zhaddContent').summernote('code')));
                    $('.enaddContent').val(Base64.encode($('.enaddContent').summernote('code')));
                    $('.kaaddContent').val(Base64.encode($('.kaaddContent').summernote('code')));
                    $('.jsaddContent').val(Base64.encode($('.jsaddContent').summernote('code')));
                    var options={
                        dataType:'json',
                        success:function (data) {
                            $("#addform")[0].reset();
                            if(data.code=='0'){
                                $("#m-add-article").modal("hide");
                                $("#data-table-selection").bootgrid("reload");
                            }else if(data.code==1002) {
								swal(data.msg);
							}else if(data.code=='3'){
                                swal('操作失败','没有权限,请联系管理员!');
                            }else{
                                swal('操作失败');
                            }
                        }
                    };
                    $("#addform").ajaxSubmit(options);
                }
            })
        });
    });
    function sendFile($summernote,file,artId) {
        oMyForm = new FormData();
        oMyForm.append("file", file);
        if(artId){
            oMyForm.append("artId",artId);
        }
        oMyForm.append("type","1");
        oMyForm.append("from","2");
        var fileData = URL.createObjectURL(file);
        $summernote.summernote('insertImage', fileData,function ($image) {
            $.ajax({
                url: "/admin/linkimg/uploadimg",
                data: oMyForm,
                cache: false,
                contentType: false,
                processData: false,
                dataType:"json",
                type: 'POST',
                success: function(data){
                    if(data.code==0) {
                        $image.attr('src', data.data);
                    }else if(data.code=='3') {
                        swal('操作失败1', '没有权限,请联系管理员!');
                    }else {
                        swal('操作失败1');
                    }
                }
            });

        });
    }
</script>
<script>
	$("#tablist1 li a").each(function(){
	    $(this).click(function(){
	    	var tabpanel1 = $(this).attr("href");
	    	$(tabpanel1).show();
	    	$(tabpanel1).siblings().hide();
			$(this).css("background-color","#2196f3","color","#555555").parents().siblings().children().removeAttr("style");
	      	//alert($(this).parents().siblings().children().attr("href"));
	    });
	});
	
	$("#uptablist1 li a").each(function(){
	    $(this).click(function(){
	    	var uptabpanel1 = $(this).attr("href");
	    	$(uptabpanel1).show();
	    	$(uptabpanel1).siblings().hide();
	      	//$(this).css("background-color","#2196f3","color","#555555").parents().siblings().children().removeAttr("style");
	    });
	});
</script>

<?php include APP_PATH.'/public/admin/footer.html' ?>
